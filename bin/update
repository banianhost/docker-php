#!/bin/bash

# Start
if [ -f /var/www/update.lock ] ; then
	echo "Lock file 'update.lock' exists, it seems it is already updating ..."
	exit 1
fi

touch /var/www/update.lock

cd /var/www/src 

# Composer
if [ -f composer.json ] ; then
    run-as-www composer install --prefer-source --no-ansi --no-interaction --no-progress --optimize-autoloader
fi

# Yarn
if [ -f yarn.lock ] ; then
    run-as-www yarn --frozen-lockfile --non-interactive
fi

# End
rm /var/www/update.lock
